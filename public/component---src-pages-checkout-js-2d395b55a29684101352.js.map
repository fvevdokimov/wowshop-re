{"version":3,"sources":["webpack:///./src/utils/use-cart.js","webpack:///./src/pages/checkout.js","webpack:///./src/components/item.js","webpack:///./src/components/cartitem.js"],"names":["isSSR","window","load","key","JSON","parse","localStorage","getItem","save","newItems","setItem","stringify","useCart","data","setData","useState","useCallback","newData","cartItems","setCartItems","addToCart","id","sizeId","count","removeFromCart","changeCartItem","undefined","Error","clearCart","useEffect","IndexPage","itemMap","Map","allStrapiItem","edges","map","item","node","cartItemList","Object","entries","get","useInput","fullName","setFullName","phone","setPhone","city","setCity","address","setAddress","email","setEmail","orderItems","itemId","substring","useRequest","status","request","statusCode","navigate","filled","title","className","to","color","price","reduce","a","b","placeholder","value","onChange","faded","disabled","loading","onClick","pageQuery","Item","style","display","state","modal","small","images","name","ev","preventDefault","CheckoutItem","alignItems","marginBottom","fixed","localFile","childImageSharp","fluid","width","height","borderRadius","marginRight","flex","sizetable","find","size","CartItem","target","selected","num"],"mappings":"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","file":"component---src-pages-checkout-js-2d395b55a29684101352.js","sourcesContent":["import {useCallback, useEffect, useState} from \"react\";\n\nconst isSSR = typeof window === \"undefined\"\nconst load = isSSR ? (key) => ({}) : (key) => JSON.parse(localStorage.getItem(key))\nconst save = isSSR ? (key) => ({}) : (key, newItems) => localStorage.setItem(key, JSON.stringify(newItems))\n\nfunction useLocalStorage(key) {\n    const [data, setData] = useState(load(key) || {})\n    const saveData = useCallback((newData) => {\n        setData(newData)\n        save(key, newData)\n    }, [key, setData]);\n    return [data, saveData]\n}\n\n// TODO: Add React context shared state\nexport function useCart() {\n    const [cartItems, setCartItems] = useLocalStorage('cart')\n    const addToCart = useCallback((id, sizeId) => {\n        const newItems = {...cartItems};\n        newItems[id] = {...(cartItems[id] || {\n            count: 0,\n            sizeId\n        })};\n        newItems[id].count++;\n        setCartItems(newItems)\n    }, [cartItems, setCartItems])\n\n    const removeFromCart = useCallback((id) => {\n        const newItems = {...cartItems}\n        delete newItems[id];\n        setCartItems(newItems)\n    }, [cartItems, setCartItems])\n\n    const changeCartItem = useCallback(({id, count, sizeId}) => {\n        const newItems = {...cartItems}\n        if(id === undefined || !newItems[id]) {\n            throw new Error('You need to provide a valid ID to change the cart item')\n        }\n        if (count === undefined || count > 0) {\n            newItems[id] = {\n                count: count || newItems[id].count,\n                sizeId: sizeId || newItems[id].sizeId\n            };\n        } else {\n            delete newItems[id];\n        }\n        setCartItems(newItems)\n    }, [cartItems, setCartItems])\n\n    const clearCart = useCallback(() => {\n        setCartItems({})\n    }, [setCartItems])\n\n    useEffect(() => {\n        if(!isSSR) {\n            window.addToCart = addToCart;\n            return () => {\n                delete window.addToCart;\n            }\n        }\n    }, [addToCart])\n\n    return {\n        cartItems,\n        addToCart,\n        removeFromCart,\n        clearCart,\n        changeCartItem\n    }\n}\n","import React, {useCallback, useEffect, useState} from \"react\"\nimport { Link } from \"gatsby\"\n\nimport Layout from \"../components/layout\"\nimport Item from \"../components/item\"\nimport SEO from \"../components/seo\"\nimport {TextInput} from \"../components/text-input\";\nimport {CheckoutItem} from \"../components/cartitem\";\nimport {PrimaryButton} from \"../components/primary-button\";\nimport '../components/checkout.scss'\nimport {Back} from \"../components/icons\";\nimport {useCart} from \"../utils/use-cart\";\nimport {useInput} from \"../utils/use-input\";\nimport {useRequest} from \"../utils/use-request\";\nimport { navigate } from \"gatsby\"\n\nconst IndexPage = ({data}) => {\n    const {cartItems, clearCart} = useCart()\n\n    const itemMap = new Map(data.allStrapiItem.edges.map(item => [item.node.id, item.node]))\n    const cartItemList = Object.entries(cartItems).map(([id, {count, sizeId}]) => ({item: itemMap.get(id), count, sizeId}))\n\n    const [fullName, setFullName] = useInput('');\n    const [phone, setPhone] = useInput('');\n    const [city, setCity] = useInput('');\n    const [address, setAddress] = useInput('');\n    const [email, setEmail] = useInput('');\n\n    // TODO: Size selection\n    const orderItems = cartItemList.map(({item, count, sizeId}) => ({itemId: +item.id.substring(5), sizeId, count}));\n\n    const [status, request] = useRequest('https://wowshop-api.wave909.com/order', 'POST', {\n        fullName, phone, city, address, email, orderItems\n    })\n\n    useEffect(() => {\n        if(status.statusCode === 200) {\n            clearCart();\n            navigate('order-complete');\n        }\n    }, [status])\n\n    const filled = !!(fullName && phone && city && address && email)\n\n    return <Layout>\n        <SEO title=\"Home\"/>\n        <div className=\"checkout__nav\"><Link to=\"boys\"><Back color=\"#87338B\"/> Вернуться к покупкам</Link></div>\n        <div className=\"checkout\">\n            <div className=\"checkout__items\">\n                <h2>В заказе</h2>\n                {cartItemList.map(({item, count, sizeId}) =>\n                    <CheckoutItem\n                        item={item}\n                        sizeId={sizeId}\n                        count={count}\n                        key={item.id}/>)}\n\n                <div className=\"checkout__total-label\">\n                    Итого:\n                    <span className=\"cart__total-number\">\n                                {cartItemList.map(({item, count}) => item.price * count)\n                                    .reduce((a,b) => a+b, 0)}.-\n                            </span>\n                </div>\n            </div>\n            <div className=\"checkout__form\">\n                <h1>Оформление заказа</h1>\n                <p className=\"checkout__tip\">Заполните все поля, для завершения</p>\n                <TextInput placeholder=\"ФИО\" value={fullName} onChange={setFullName}/>\n                <TextInput placeholder=\"Телефон\" value={phone} onChange={setPhone} faded={!fullName} />\n                <TextInput placeholder=\"Город доставки\" value={city} onChange={setCity} faded={!phone} />\n                <TextInput placeholder=\"Адрес доставки\" value={address} onChange={setAddress} faded={!city} />\n                <TextInput placeholder=\"Email\" value={email} onChange={setEmail} faded={!address} />\n                <p className=\"checkout__privacy-policy__description\">Нажимая «Отправить заказ» вы соглашаетесь с <span className=\"checkout__privacy-policy__link\">политикой конфиденциальности</span></p>\n                <PrimaryButton disabled={!filled || status.loading} onClick={request}>Отправить заказ<div className=\"send\"/></PrimaryButton>\n            </div>\n        </div>\n    </Layout>\n}\n\nexport default IndexPage\n\n\nexport const pageQuery = graphql`\n    query CheckoutQuery {\n        allStrapiItem {\n            edges {\n                node {\n                    id\n                    name\n                    price\n                    for      \n                    images {\n                        localFile {\n                           publicURL\n                           childImageSharp {\n                               fluid(maxWidth: 400, maxHeight: 400) {\n                                   ...GatsbyImageSharpFluid_noBase64\n                               }\n                           }\n                        }\n                    }\n                    type {\n                        id\n                        shortname\n                        fullnameboy\n                        fullnamegirl\n                    }\n                    sizetable {\n                        id\n                        size\n                        armlength\n                        ziplength\n                        seamlength\n                    }\n                }\n            }\n        }\n        allStrapiType {\n            edges {\n                node {\n                    id\n                    shortname\n                    fullnameboy\n                    fullnamegirl\n                }\n            }\n        }\n        banner: file(relativePath: { eq: \"banner.png\" }) {\n           childImageSharp {\n               fixed(width: 787, height: 310) {\n                   ...GatsbyImageSharpFixed\n               }\n           }\n        }\n    }\n    \n`\n","import {Link} from \"gatsby\";\nimport React from \"react\";\nimport Img from \"gatsby-image\"\n\nimport \"./item.scss\"\nimport {Carousel} from \"./carousel\";\n\nconst Item = ({item, addToCart}) => (\n    <Link to={`/${item.id}`}\n          style={{display: 'flex'}}\n          state={{\n              modal: true\n          }}>\n        <div key={item.id} className='itemBlock'>\n            <Carousel small images={item.images}/>\n            <div className=\"itemData\">\n                <p className='itemName'>\n                {item.name}\n                </p>\n                <p className='itemPrice'>{item.price}.-</p>\n                <button onClick={(ev) => {\n                    addToCart(item.id, 1) // TODO: Size selector\n                    ev.preventDefault()\n                }} className='itemCart'/>\n            </div>\n        </div>\n    </Link>\n)\n\nexport default Item;\n","import {Link} from \"gatsby\";\nimport React from \"react\";\nimport Img from \"gatsby-image\"\nimport './cartitem.css'\n\nexport const CheckoutItem = ({item, count, sizeId, removeFromCart}) => (\n    <div key={item.id} style={{display: 'flex', alignItems: 'center', marginBottom: 16}}>\n        <Img fixed={item.images[0].localFile.childImageSharp.fluid} style={{width: 92, height: 92, borderRadius: 10, marginRight: 20}}/>\n        <div style={{flex: 1}}>\n            <span className=\"checkout-item__header\">\n                {item.name}\n            </span>\n            <div className=\"checkout-item__controls-row\">\n                <span><b>Размер:</b> {item.sizetable.find(({id}) => id === sizeId).size}</span>\n            </div>\n            <div className=\"checkout-item__controls-row\">\n                <span><b>{count} шт.</b></span>\n                <span>{item.price}.-</span>\n                <div className=\"checkout-item__total\">{item.price * count}.-</div>\n            </div>\n        </div>\n    </div>\n)\n\nconst CartItem = ({item, count, sizeId, removeFromCart, changeCartItem}) => (\n    <div key={item.id} style={{display: 'flex', alignItems: 'center', marginBottom: 16}}>\n        <Img fixed={item.images[0].localFile.childImageSharp.fluid} style={{width: 92, height: 92, borderRadius: 10, marginRight: 20}}/>\n        <div style={{flex: 1}}>\n            <span className=\"cart-item__header\">\n                {item.name}\n            </span>\n            <div className=\"cart-item__controls-row\">\n                <span><b>Размер:</b>\n                    <select className=\"select\" name=\"dropdown\"\n                            onChange={({target}) => changeCartItem({id: item.id, sizeId: +target.value})}>\n                    {item.sizetable.map(({id, size}) =>\n                        <option value={id} selected={id === sizeId}>{size}</option>)}\n                    </select>\n                </span>\n                <span><select className=\"select\" name=\"dropdown\"\n                        onChange={({target}) => changeCartItem({id: item.id, count: +target.value})}>\n                    {[...(count > 5 ? [count] : []),1,2,3,4,5,0].map(num =>\n                        <option value={num} selected={num === count}>{num} шт.</option>)}\n                </select></span>\n                <span>{item.price}.-</span>\n            </div>\n        </div>\n        <span className=\"cart-item__total\">{item.price * count}.-</span>\n    </div>\n)\n\nexport default CartItem;\n"],"sourceRoot":""}